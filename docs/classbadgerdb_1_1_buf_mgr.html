<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BadgerDB: badgerdb::BufMgr Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacebadgerdb.html">badgerdb</a>::<a class="el" href="classbadgerdb_1_1_buf_mgr.html">BufMgr</a>
  </div>
</div>
<div class="contents">
<h1>badgerdb::BufMgr Class Reference</h1><!-- doxytag: class="badgerdb::BufMgr" -->
<p>The central class which manages the buffer pool including frame allocation and deallocation to pages in the file.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="buffer_8h_source.html">buffer.h</a>&gt;</code></p>

<p><a href="classbadgerdb_1_1_buf_mgr-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a18b7cf23b619c7c0e593d1dc45da77b4">BufMgr</a> (std::uint32_t bufs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#aab08001e1be18bfbd4af9113e91cf953">~BufMgr</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">readPage</a> (<a class="el" href="classbadgerdb_1_1_file.html">File</a> *file, const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> PageNo, <a class="el" href="classbadgerdb_1_1_page.html">Page</a> *&amp;page)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a> (<a class="el" href="classbadgerdb_1_1_file.html">File</a> *file, const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> PageNo, const bool dirty)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">allocPage</a> (<a class="el" href="classbadgerdb_1_1_file.html">File</a> *file, <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> &amp;PageNo, <a class="el" href="classbadgerdb_1_1_page.html">Page</a> *&amp;page)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#acc61d1985720411ebb76e70f702827d3">flushFile</a> (const <a class="el" href="classbadgerdb_1_1_file.html">File</a> *file)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a870a80a0f0abcf3b640b913b46b64486">disposePage</a> (<a class="el" href="classbadgerdb_1_1_file.html">File</a> *file, const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> PageNo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a598b3112b8193af603f5bc97c478a671">printSelf</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structbadgerdb_1_1_buf_stats.html">BufStats</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a93148e1af99f06f4f264d948920b7c1c">getBufStats</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#a702a264ae946b334414e51700edd81a0">clearBufStats</a> ()</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbadgerdb_1_1_page.html">Page</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The central class which manages the buffer pool including frame allocation and deallocation to pages in the file. </p>

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00160">160</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a18b7cf23b619c7c0e593d1dc45da77b4"></a><!-- doxytag: member="badgerdb::BufMgr::BufMgr" ref="a18b7cf23b619c7c0e593d1dc45da77b4" args="(std::uint32_t bufs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">badgerdb::BufMgr::BufMgr </td>
          <td>(</td>
          <td class="paramtype">std::uint32_t&nbsp;</td>
          <td class="paramname"> <em>bufs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor of <a class="el" href="classbadgerdb_1_1_buf_mgr.html" title="The central class which manages the buffer pool including frame allocation and deallocation...">BufMgr</a> class </p>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00039">39</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00040"></a>00040   : numBufs(bufs) {
<a name="l00041"></a>00041   bufDescTable = <span class="keyword">new</span> BufDesc[bufs];
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keywordflow">for</span> (<a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> i = 0; i &lt; bufs; i++) 
<a name="l00044"></a>00044   {
<a name="l00045"></a>00045     bufDescTable[i].frameNo = i;
<a name="l00046"></a>00046     bufDescTable[i].valid = <span class="keyword">false</span>;
<a name="l00047"></a>00047   }
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a> = <span class="keyword">new</span> Page[bufs];
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="keywordtype">int</span> htsize = ((((int) (bufs * 1.2))*2)/2)+1;
<a name="l00052"></a>00052   hashTable = <span class="keyword">new</span> BufHashTbl (htsize);  <span class="comment">// allocate the buffer hash table</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   clockHand = bufs - 1;
<a name="l00055"></a>00055 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab08001e1be18bfbd4af9113e91cf953"></a><!-- doxytag: member="badgerdb::BufMgr::~BufMgr" ref="aab08001e1be18bfbd4af9113e91cf953" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">badgerdb::BufMgr::~BufMgr </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor of <a class="el" href="classbadgerdb_1_1_buf_mgr.html" title="The central class which manages the buffer pool including frame allocation and deallocation...">BufMgr</a> class </p>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00065">65</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00065"></a>00065                 {
<a name="l00066"></a>00066   <span class="comment">//Goes through bufDescTable and flushes out all pages with a dirty bit</span>
<a name="l00067"></a>00067   <span class="keywordflow">for</span> (<a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> i = 0; i &lt; numBufs; i++)
<a name="l00068"></a>00068   {
<a name="l00069"></a>00069     <span class="keywordflow">if</span>(bufDescTable[i].dirty == <span class="keyword">true</span>){
<a name="l00070"></a>00070       <a class="code" href="classbadgerdb_1_1_buf_mgr.html#acc61d1985720411ebb76e70f702827d3">flushFile</a>(bufDescTable[i].file);
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073   <span class="comment">//Deallocate bufDescTable, bufPool and hashTable</span>
<a name="l00074"></a>00074   <span class="keyword">delete</span> [] bufDescTable;
<a name="l00075"></a>00075   <span class="keyword">delete</span> [] <a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>;
<a name="l00076"></a>00076   <span class="keyword">delete</span> [] hashTable;
<a name="l00077"></a>00077 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab9ae3b12aac55b119b5763e3de2a4d2b"></a><!-- doxytag: member="badgerdb::BufMgr::allocPage" ref="ab9ae3b12aac55b119b5763e3de2a4d2b" args="(File *file, PageId &amp;PageNo, Page *&amp;page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::allocPage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_file.html">File</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>PageNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_page.html">Page</a> *&amp;&nbsp;</td>
          <td class="paramname"> <em>page</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocates a new, empty page in the file and returns the <a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> object. The newly allocated page is also assigned a frame in the buffer pool.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_file.html" title="Class which represents a file in the filesystem containing database pages.">File</a> object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PageNo</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> number. The number assigned to the page in the file is returned via this reference. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>page</em>&nbsp;</td><td>Reference to page pointer. The newly allocated in-memory <a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> object is returned via this reference. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00295">295</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00296"></a>00296 {
<a name="l00297"></a>00297   <a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> frameNo;
<a name="l00298"></a>00298   <span class="comment">// Allocate an empty page in the specified file which returns a newly allocated page</span>
<a name="l00299"></a>00299   Page currentPage = file-&gt;allocatePage();
<a name="l00300"></a>00300   <span class="comment">// Obtain a buffer pool frame</span>
<a name="l00301"></a>00301   allocBuf(frameNo);
<a name="l00302"></a>00302   <a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[frameNo] = currentPage;
<a name="l00303"></a>00303   <span class="comment">// Entry is inserted into the hash table</span>
<a name="l00304"></a>00304   hashTable-&gt;insert(file, currentPage.page_number(), frameNo);
<a name="l00305"></a>00305   <span class="comment">//Call Set() on the frame</span>
<a name="l00306"></a>00306   bufDescTable[frameNo].Set(file, currentPage.page_number());
<a name="l00307"></a>00307   <span class="comment">// return both page number of newly allocated page to the caller via the pageNo param</span>
<a name="l00308"></a>00308   <span class="comment">// and a pointer to the buffer frame allocated for the page via page param</span>
<a name="l00309"></a>00309   pageNo = currentPage.page_number();
<a name="l00310"></a>00310   page = &amp;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[frameNo];
<a name="l00311"></a>00311 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a702a264ae946b334414e51700edd81a0"></a><!-- doxytag: member="badgerdb::BufMgr::clearBufStats" ref="a702a264ae946b334414e51700edd81a0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::clearBufStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Clear buffer pool usage statistics </p>

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00284">284</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00285"></a>00285   {
<a name="l00286"></a>00286     bufStats.clear();
<a name="l00287"></a>00287   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a870a80a0f0abcf3b640b913b46b64486"></a><!-- doxytag: member="badgerdb::BufMgr::disposePage" ref="a870a80a0f0abcf3b640b913b46b64486" args="(File *file, const PageId PageNo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::disposePage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_file.html">File</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a>&nbsp;</td>
          <td class="paramname"> <em>PageNo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Delete page from file and also from buffer pool if present. Since the page is entirely deleted from file, its unnecessary to see if the page is dirty.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_file.html" title="Class which represents a file in the filesystem containing database pages.">File</a> object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PageNo</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> number </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00321">321</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> tmp;
<a name="l00324"></a>00324     <span class="comment">// This method deletes a particular page from file.</span>
<a name="l00325"></a>00325     <span class="keywordflow">try</span> {
<a name="l00326"></a>00326         hashTable-&gt;lookup(file, PageNo, tmp);
<a name="l00327"></a>00327         <span class="comment">// Make sure that if the page to be deleted is allocated to a frame in the buffer</span>
<a name="l00328"></a>00328         <span class="comment">// pool, that frame is freed and correspondingly entry from hash table is also</span>
<a name="l00329"></a>00329         <span class="comment">// removed</span>
<a name="l00330"></a>00330         bufDescTable[tmp].Clear();
<a name="l00331"></a>00331         hashTable-&gt;remove(file, PageNo);
<a name="l00332"></a>00332     } <span class="keywordflow">catch</span>(HashNotFoundException e) {}
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">// After checks, delete page from the file</span>
<a name="l00335"></a>00335     file-&gt;deletePage(PageNo);
<a name="l00336"></a>00336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acc61d1985720411ebb76e70f702827d3"></a><!-- doxytag: member="badgerdb::BufMgr::flushFile" ref="acc61d1985720411ebb76e70f702827d3" args="(const File *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::flushFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classbadgerdb_1_1_file.html">File</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes out all dirty pages of the file to disk. All the frames assigned to the file need to be unpinned from buffer pool before this function can be successfully called. Otherwise Error returned.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_file.html" title="Class which represents a file in the filesystem containing database pages.">File</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classbadgerdb_1_1_page_pinned_exception.html" title="An exception that is thrown when a page which is not expected to be pinned in the...">PagePinnedException</a></em>&nbsp;</td><td>If any page of the file is pinned in the buffer pool </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classbadgerdb_1_1_bad_buffer_exception.html" title="An exception that is thrown when a buffer is found whose valid is false but other...">BadBufferException</a></em>&nbsp;</td><td>If any frame allocated to the file is found to be invalid </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00251">251</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00252"></a>00252 {
<a name="l00253"></a>00253   <span class="comment">// Scan bufPool</span>
<a name="l00254"></a>00254   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numBufs; i++){
<a name="l00255"></a>00255   <span class="comment">// checks if page corresponds to file and is valid</span>
<a name="l00256"></a>00256   <span class="keywordflow">if</span>(bufDescTable[i].file == file &amp;&amp; bufDescTable[i].valid == <span class="keyword">true</span>){
<a name="l00257"></a>00257    <span class="comment">// Throws exception if page already pinned</span>
<a name="l00258"></a>00258    <span class="keywordflow">if</span>(bufDescTable[i].pinCnt &gt; 0) {
<a name="l00259"></a>00259        <span class="keywordflow">throw</span> PagePinnedException(<span class="stringliteral">&quot;Page is pinned&quot;</span>, bufDescTable[i].pageNo, bufDescTable[i].frameNo);
<a name="l00260"></a>00260    }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262    <span class="comment">// Check if dirty bit is true</span>
<a name="l00263"></a>00263    <span class="keywordflow">if</span> (bufDescTable[i].dirty == <span class="keyword">true</span>){
<a name="l00264"></a>00264     <span class="comment">//Flush page to disk</span>
<a name="l00265"></a>00265     bufDescTable[i].file-&gt;writePage(<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[bufDescTable[i].frameNo]);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="comment">//Reset dirty bit</span>
<a name="l00268"></a>00268     bufDescTable[i].dirty = <span class="keyword">false</span>;
<a name="l00269"></a>00269    }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="comment">//Remove page from hashtable</span>
<a name="l00272"></a>00272     hashTable-&gt;remove(file,bufDescTable[i].pageNo);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="comment">//Invoke clear() to clear page frame</span>
<a name="l00275"></a>00275     bufDescTable[i].Clear();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278   <span class="keywordflow">else</span>{
<a name="l00279"></a>00279       <span class="keywordflow">throw</span> BadBufferException(bufDescTable[i].frameNo, bufDescTable[i].dirty, bufDescTable[i].valid, bufDescTable[i].refbit);
<a name="l00280"></a>00280   }
<a name="l00281"></a>00281  }
<a name="l00282"></a>00282 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a93148e1af99f06f4f264d948920b7c1c"></a><!-- doxytag: member="badgerdb::BufMgr::getBufStats" ref="a93148e1af99f06f4f264d948920b7c1c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structbadgerdb_1_1_buf_stats.html">BufStats</a>&amp; badgerdb::BufMgr::getBufStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get buffer pool usage statistics </p>

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00276">276</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00277"></a>00277   {
<a name="l00278"></a>00278     <span class="keywordflow">return</span> bufStats;
<a name="l00279"></a>00279   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a598b3112b8193af603f5bc97c478a671"></a><!-- doxytag: member="badgerdb::BufMgr::printSelf" ref="a598b3112b8193af603f5bc97c478a671" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::printSelf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Print member variable values. </p>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00346">346</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00347"></a>00347 {
<a name="l00348"></a>00348   BufDesc* tmpbuf;
<a name="l00349"></a>00349   <span class="keywordtype">int</span> validFrames = 0;
<a name="l00350"></a>00350   
<a name="l00351"></a>00351   <span class="keywordflow">for</span> (std::uint32_t i = 0; i &lt; numBufs; i++)
<a name="l00352"></a>00352   {
<a name="l00353"></a>00353     tmpbuf = &amp;(bufDescTable[i]);
<a name="l00354"></a>00354     std::cout &lt;&lt; <span class="stringliteral">&quot;FrameNo:&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00355"></a>00355     tmpbuf-&gt;Print();
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="keywordflow">if</span> (tmpbuf-&gt;valid == <span class="keyword">true</span>)
<a name="l00358"></a>00358       validFrames++;
<a name="l00359"></a>00359   }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   std::cout &lt;&lt; <span class="stringliteral">&quot;Total Number of Valid Frames:&quot;</span> &lt;&lt; validFrames &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00362"></a>00362 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f853f0f1d4628e7e14374d0c7c6a4f3"></a><!-- doxytag: member="badgerdb::BufMgr::readPage" ref="a9f853f0f1d4628e7e14374d0c7c6a4f3" args="(File *file, const PageId PageNo, Page *&amp;page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::readPage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_file.html">File</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a>&nbsp;</td>
          <td class="paramname"> <em>PageNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_page.html">Page</a> *&amp;&nbsp;</td>
          <td class="paramname"> <em>page</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads the given page from the file into a frame and returns the pointer to page. If the requested page is already present in the buffer pool pointer to that frame is returned otherwise a new frame is allocated from the buffer pool for reading the page.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_file.html" title="Class which represents a file in the filesystem containing database pages.">File</a> object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PageNo</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> number in the file to be read </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>page</em>&nbsp;</td><td>Reference to page pointer. Used to fetch the <a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> object in which requested page from file is read in. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00179">179</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00180"></a>00180 {
<a name="l00181"></a>00181   <span class="comment">// First check whether the page is already in the buffer pool</span>
<a name="l00182"></a>00182   <a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> tmp;
<a name="l00183"></a>00183   <span class="keywordflow">try</span>{
<a name="l00184"></a>00184    <span class="comment">// Case 2: page is in the buffer pool</span>
<a name="l00185"></a>00185    hashTable-&gt;lookup(file, pageNo, tmp);
<a name="l00186"></a>00186    <span class="comment">// Set the appropriate refbit</span>
<a name="l00187"></a>00187    bufDescTable[tmp].refbit = <span class="keyword">true</span>;
<a name="l00188"></a>00188    <span class="comment">// Increment pin count for the page</span>
<a name="l00189"></a>00189    bufDescTable[tmp].pinCnt++;
<a name="l00190"></a>00190    <span class="comment">// return pointer to the frame containing the page via page param</span>
<a name="l00191"></a>00191    page = &amp;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[tmp];
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keywordflow">catch</span>(HashNotFoundException e){
<a name="l00195"></a>00195       <span class="comment">// Case 1: If page is not in the buffer pool</span>
<a name="l00196"></a>00196       <span class="comment">//Allocate buffer frame</span>
<a name="l00197"></a>00197       allocBuf(tmp);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199       <span class="comment">//Read page </span>
<a name="l00200"></a>00200       <a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[tmp] = file-&gt;readPage(pageNo);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       <span class="comment">//Insert page into hashtable</span>
<a name="l00203"></a>00203       hashTable-&gt;insert(file,pageNo,tmp);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       <span class="comment">// invoke Set() on the frame to set it up properly</span>
<a name="l00206"></a>00206       bufDescTable[tmp].Set(file,pageNo);
<a name="l00207"></a>00207       <span class="comment">// Return a pointer to the frame containing the page via page param</span>
<a name="l00208"></a>00208       page = &amp;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">bufPool</a>[tmp];
<a name="l00209"></a>00209   }
<a name="l00210"></a>00210 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa9bdf04c8543f59744db22efa9420c89"></a><!-- doxytag: member="badgerdb::BufMgr::unPinPage" ref="aa9bdf04c8543f59744db22efa9420c89" args="(File *file, const PageId PageNo, const bool dirty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void badgerdb::BufMgr::unPinPage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_file.html">File</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a>&nbsp;</td>
          <td class="paramname"> <em>PageNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&nbsp;</td>
          <td class="paramname"> <em>dirty</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unpin a page from memory since it is no longer required for it to remain in memory.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_file.html" title="Class which represents a file in the filesystem containing database pages.">File</a> object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PageNo</em>&nbsp;</td><td><a class="el" href="classbadgerdb_1_1_page.html" title="Class which represents a fixed-size database page containing records.">Page</a> number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dirty</em>&nbsp;</td><td>True if the page to be unpinned needs to be marked dirty </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classbadgerdb_1_1_page_not_pinned_exception.html" title="An exception that is thrown when a page which is expected to be pinned in the buffer...">PageNotPinnedException</a></em>&nbsp;</td><td>If the page is not already pinned </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8cpp_source.html#l00218">218</a> of file <a class="el" href="buffer_8cpp_source.html">buffer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00219"></a>00219 {
<a name="l00220"></a>00220   <a class="code" href="namespacebadgerdb.html#a1e7378fbefaea050a47e6cde929e9c01" title="Identifier for a frame in buffer pool.">FrameId</a> tmp;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <span class="keywordflow">try</span>{
<a name="l00223"></a>00223    <span class="comment">//Lookup file and page number</span>
<a name="l00224"></a>00224    hashTable-&gt;lookup(file, pageNo, tmp);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226    <span class="comment">// Throw exception if pinCnt is already 0</span>
<a name="l00227"></a>00227    <span class="keywordflow">if</span>(bufDescTable[tmp].pinCnt == 0){
<a name="l00228"></a>00228      <span class="keywordflow">throw</span> PageNotPinnedException(<span class="stringliteral">&quot;PinCnt already 0&quot;</span>,pageNo,tmp);
<a name="l00229"></a>00229    }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231    <span class="comment">// Decrement pin count</span>
<a name="l00232"></a>00232    bufDescTable[tmp].pinCnt--;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    <span class="comment">// This check is for the test cases</span>
<a name="l00235"></a>00235    <span class="keywordflow">if</span>(dirty == <span class="keyword">true</span>){
<a name="l00236"></a>00236     bufDescTable[tmp].dirty = <span class="keyword">true</span>;
<a name="l00237"></a>00237    }
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="comment">// Catch exception if lookup failed</span>
<a name="l00241"></a>00241   <span class="keywordflow">catch</span>(HashNotFoundException e){}
<a name="l00242"></a>00242 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aa498047fc351652d0bc7eabf6cb62ab0"></a><!-- doxytag: member="badgerdb::BufMgr::bufPool" ref="aa498047fc351652d0bc7eabf6cb62ab0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbadgerdb_1_1_page.html">Page</a>* <a class="el" href="classbadgerdb_1_1_buf_mgr.html#aa498047fc351652d0bc7eabf6cb62ab0">badgerdb::BufMgr::bufPool</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Actual buffer pool from which frames are allocated </p>

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00205">205</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/linux/ieng6/oce/2d/amquinte/CSE190D/src/<a class="el" href="buffer_8h_source.html">buffer.h</a></li>
<li>/home/linux/ieng6/oce/2d/amquinte/CSE190D/src/<a class="el" href="buffer_8cpp_source.html">buffer.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Apr 2017 for BadgerDB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
